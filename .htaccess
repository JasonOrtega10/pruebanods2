RewriteEngine On

RewriteCond %{SERVER_PORT} !=3000
RewriteRule ^(.*)$ https://%{HTTP_HOST}:3000/$1 [R=301,L]
Header always set Content-Security-Policy "upgrade-insecure-requests;" 

RewriteCond %{HTTPS} off
RewriteRule ^(.*)$ https://%{HTTP_HOST}:3000/$1 [R=301,L]
Header always set Content-Security-Policy "upgrade-insecure-requests;" 

RewriteCond %{HTTPS} !=on
RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301,NE]
Header always set Content-Security-Policy "upgrade-insecure-requests;" 